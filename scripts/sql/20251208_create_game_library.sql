CREATE TABLE REGION_DEFINITIONS (
    REGION_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    REGION_CODE VARCHAR2(10) NOT NULL UNIQUE,
    REGION_NAME VARCHAR2(100) NOT NULL
);

CREATE TABLE PLATFORM_DEFINITIONS (
    PLATFORM_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    PLATFORM_CODE VARCHAR2(20) NOT NULL UNIQUE,
    PLATFORM_NAME VARCHAR2(100) NOT NULL
);

CREATE TABLE GAMES (
    GAME_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    TITLE VARCHAR2(255) NOT NULL UNIQUE,
    DESCRIPTION CLOB,
    IMAGE_DATA BLOB,
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE GAME_RELEASES (
    RELEASE_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    GAME_ID NUMBER NOT NULL,
    PLATFORM_ID NUMBER NOT NULL,
    REGION_ID NUMBER NOT NULL,
    FORMAT VARCHAR2(20) CHECK (FORMAT IN ('Physical', 'Digital')),
    RELEASE_DATE DATE,
    NOTES VARCHAR2(255),
    CONSTRAINT FK_GR_GAME FOREIGN KEY (GAME_ID) REFERENCES GAMES(GAME_ID) ON DELETE CASCADE,
    CONSTRAINT FK_GR_PLATFORM FOREIGN KEY (PLATFORM_ID) REFERENCES PLATFORM_DEFINITIONS(PLATFORM_ID),
    CONSTRAINT FK_GR_REGION FOREIGN KEY (REGION_ID) REFERENCES REGION_DEFINITIONS(REGION_ID)
);

CREATE INDEX IDX_GR_GAME ON GAME_RELEASES(GAME_ID);
CREATE INDEX IDX_GR_PLATFORM ON GAME_RELEASES(PLATFORM_ID);
CREATE INDEX IDX_GR_REGION ON GAME_RELEASES(REGION_ID);

-- Seed Initial Regions
INSERT INTO REGION_DEFINITIONS (REGION_CODE, REGION_NAME) VALUES ('NA', 'North America');
INSERT INTO REGION_DEFINITIONS (REGION_CODE, REGION_NAME) VALUES ('EU', 'Europe');
INSERT INTO REGION_DEFINITIONS (REGION_CODE, REGION_NAME) VALUES ('JP', 'Japan');
INSERT INTO REGION_DEFINITIONS (REGION_CODE, REGION_NAME) VALUES ('WW', 'Worldwide');

-- Seed Initial Platforms
INSERT INTO PLATFORM_DEFINITIONS (PLATFORM_CODE, PLATFORM_NAME) VALUES ('SWITCH', 'Nintendo Switch');
INSERT INTO PLATFORM_DEFINITIONS (PLATFORM_CODE, PLATFORM_NAME) VALUES ('PS5', 'PlayStation 5');
INSERT INTO PLATFORM_DEFINITIONS (PLATFORM_CODE, PLATFORM_NAME) VALUES ('PS4', 'PlayStation 4');
INSERT INTO PLATFORM_DEFINITIONS (PLATFORM_CODE, PLATFORM_NAME) VALUES ('PC', 'PC (Windows/Linux/Mac)');
INSERT INTO PLATFORM_DEFINITIONS (PLATFORM_CODE, PLATFORM_NAME) VALUES ('XBOX', 'Xbox Series X|S');
