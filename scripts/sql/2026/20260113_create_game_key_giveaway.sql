CREATE TABLE RPG_CLUB_GAME_KEYS (
  KEY_ID              NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
  GAME_TITLE          VARCHAR2(200) NOT NULL,
  PLATFORM            VARCHAR2(50) NOT NULL,
  KEY_VALUE           VARCHAR2(200) NOT NULL,
  DONOR_USER_ID       VARCHAR2(30) NOT NULL,
  CLAIMED_BY_USER_ID  VARCHAR2(30),
  CLAIMED_AT          TIMESTAMP WITH TIME ZONE,
  CREATED_AT          TIMESTAMP WITH TIME ZONE DEFAULT SYSTIMESTAMP NOT NULL,
  UPDATED_AT          TIMESTAMP WITH TIME ZONE DEFAULT SYSTIMESTAMP NOT NULL
);

CREATE INDEX IX_GAME_KEYS_TITLE ON RPG_CLUB_GAME_KEYS (GAME_TITLE);
CREATE INDEX IX_GAME_KEYS_AVAILABLE ON RPG_CLUB_GAME_KEYS (CLAIMED_BY_USER_ID, GAME_TITLE);

CREATE OR REPLACE TRIGGER TRG_RPG_CLUB_GAME_KEYS_UPD
BEFORE UPDATE ON RPG_CLUB_GAME_KEYS
FOR EACH ROW
BEGIN
  :NEW.UPDATED_AT := SYSTIMESTAMP;
END;
/

commit;
