DECLARE
  v_table_count NUMBER := 0;
  v_index_count NUMBER := 0;
BEGIN
  SELECT COUNT(*)
    INTO v_table_count
    FROM USER_TABLES
   WHERE TABLE_NAME = 'GAMEDB_SEARCH_SYNONYM_GROUPS';
  IF v_table_count = 0 THEN
    EXECUTE IMMEDIATE '
      CREATE TABLE GAMEDB_SEARCH_SYNONYM_GROUPS (
        GROUP_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
        CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
        CREATED_BY VARCHAR2(64)
      )';
  END IF;

  SELECT COUNT(*)
    INTO v_table_count
    FROM USER_TABLES
   WHERE TABLE_NAME = 'GAMEDB_SEARCH_SYNONYMS';
  IF v_table_count = 0 THEN
    EXECUTE IMMEDIATE '
      CREATE TABLE GAMEDB_SEARCH_SYNONYMS (
        TERM_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
        GROUP_ID NUMBER NOT NULL,
        TERM_TEXT VARCHAR2(255) NOT NULL,
        TERM_NORM VARCHAR2(255) NOT NULL,
        CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
        CREATED_BY VARCHAR2(64),
        CONSTRAINT FK_GAMEDB_SEARCH_SYNONYMS_GROUP
          FOREIGN KEY (GROUP_ID)
          REFERENCES GAMEDB_SEARCH_SYNONYM_GROUPS (GROUP_ID),
        CONSTRAINT UK_GAMEDB_SEARCH_SYNONYMS_NORM
          UNIQUE (TERM_NORM)
      )';
  END IF;

  SELECT COUNT(*)
    INTO v_index_count
    FROM USER_INDEXES
   WHERE INDEX_NAME = 'IDX_GAMEDB_SEARCH_SYNONYMS_GROUP';
  IF v_index_count = 0 THEN
    EXECUTE IMMEDIATE '
      CREATE INDEX IDX_GAMEDB_SEARCH_SYNONYMS_GROUP
        ON GAMEDB_SEARCH_SYNONYMS (GROUP_ID)';
  END IF;
END;
/
