CREATE TABLE RPG_CLUB_USER_ACTIVITY_ICONS (
  ID NUMBER GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  USER_ID VARCHAR2(128) NOT NULL,
  USERNAME VARCHAR2(256) NULL,
  ACTIVITY_NAME VARCHAR2(256) NOT NULL,
  ACTIVITY_NAME_NORM VARCHAR2(256) NOT NULL,
  ICON_TYPE VARCHAR2(16) NOT NULL,
  SOURCE_REF VARCHAR2(1024) NOT NULL,
  ICON_URL VARCHAR2(2048) NOT NULL,
  FIRST_SEEN_AT TIMESTAMP DEFAULT SYSTIMESTAMP NOT NULL,
  LAST_SEEN_AT TIMESTAMP DEFAULT SYSTIMESTAMP NOT NULL,
  SEEN_COUNT NUMBER DEFAULT 1 NOT NULL,
  CONSTRAINT PK_RPG_CLUB_USER_ACTIVITY_ICONS PRIMARY KEY (ID),
  CONSTRAINT UQ_RPG_CLUB_USER_ACTIVITY_ICONS_REF
    UNIQUE (USER_ID, ACTIVITY_NAME_NORM, ICON_TYPE, SOURCE_REF),
  CONSTRAINT CHK_RPG_CLUB_USER_ACTIVITY_ICON_TYPE
    CHECK (ICON_TYPE IN ('large', 'small')),
  CONSTRAINT CHK_RPG_CLUB_USER_ACTIVITY_ICON_COUNT
    CHECK (SEEN_COUNT >= 1)
);

CREATE INDEX IDX_RPG_CLUB_USER_ACTIVITY_ICONS_LOOKUP
  ON RPG_CLUB_USER_ACTIVITY_ICONS (USER_ID, LAST_SEEN_AT, ACTIVITY_NAME_NORM, ICON_TYPE);

COMMIT;
