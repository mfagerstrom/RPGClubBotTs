-- Creates missing core tables referenced by later migration scripts.
-- Generated from db/*.md documentation.

whenever sqlerror exit failure rollback
set define off
set echo on
set feedback on
set timing on

-- BOT_VOTING_INFO
CREATE TABLE BOT_VOTING_INFO (
  ROUND_NUMBER NUMBER(10,0) NOT NULL,
  NOMINATION_LIST_ID NUMBER(10,0),
  NEXT_VOTE_AT DATE NOT NULL,
  FIVE_DAY_REMINDER_SENT NUMBER(1,0) DEFAULT 0 NOT NULL,
  ONE_DAY_REMINDER_SENT NUMBER(1,0) DEFAULT 0 NOT NULL
);

CREATE INDEX IX_BOT_VOTING_INFO_ROUND ON BOT_VOTING_INFO (ROUND_NUMBER);

-- BOT_PRESENCE_HISTORY
CREATE TABLE BOT_PRESENCE_HISTORY (
  ID NUMBER GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  ACTIVITY_NAME VARCHAR2(1020) NOT NULL,
  SET_AT TIMESTAMP(6) DEFAULT SYSTIMESTAMP NOT NULL,
  SET_BY_USER_ID VARCHAR2(128),
  SET_BY_USERNAME VARCHAR2(256),
  CONSTRAINT PK_BOT_PRESENCE_HISTORY PRIMARY KEY (ID)
);

CREATE INDEX IX_BOT_PRESENCE_HISTORY_SET_AT ON BOT_PRESENCE_HISTORY (SET_AT);

-- HELP
CREATE TABLE HELP (
  TOPIC VARCHAR2(50) NOT NULL,
  SEQ NUMBER NOT NULL,
  INFO VARCHAR2(80),
  CONSTRAINT PK_HELP PRIMARY KEY (TOPIC, SEQ)
);

CREATE INDEX HELP_TOPIC_SEQ ON HELP (TOPIC, SEQ);

-- GOTM_ENTRIES
CREATE TABLE GOTM_ENTRIES (
  GOTM_ID NUMBER GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  ROUND_NUMBER NUMBER(5,0) NOT NULL,
  MONTH_YEAR VARCHAR2(200) NOT NULL,
  GAME_INDEX NUMBER(3,0) NOT NULL,
  GAME_TITLE VARCHAR2(1020) NOT NULL,
  THREAD_ID VARCHAR2(200),
  REDDIT_URL VARCHAR2(2048),
  VOTING_RESULTS_MESSAGE_ID VARCHAR2(200),
  IMAGE_BLOB BLOB,
  IMAGE_MIME_TYPE VARCHAR2(128),
  CONSTRAINT PK_GOTM_ENTRIES_ID PRIMARY KEY (GOTM_ID)
);

CREATE UNIQUE INDEX UK_GOTM_ROUND_IDX ON GOTM_ENTRIES (ROUND_NUMBER, GAME_INDEX);
CREATE INDEX IX_GOTM_MONTH_YEAR ON GOTM_ENTRIES (MONTH_YEAR);
CREATE INDEX IX_GOTM_ROUND ON GOTM_ENTRIES (ROUND_NUMBER);
CREATE INDEX IX_GOTM_TITLE ON GOTM_ENTRIES (GAME_TITLE);

-- NR_GOTM_ENTRIES
CREATE TABLE NR_GOTM_ENTRIES (
  ROUND_NUMBER NUMBER NOT NULL,
  MONTH_YEAR VARCHAR2(50) NOT NULL,
  GAME_INDEX NUMBER NOT NULL,
  GAME_TITLE VARCHAR2(255) NOT NULL,
  THREAD_ID VARCHAR2(50),
  REDDIT_URL VARCHAR2(500),
  VOTING_RESULTS_MESSAGE_ID VARCHAR2(50),
  NR_GOTM_ID NUMBER GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  IMAGE_BLOB BLOB,
  IMAGE_MIME_TYPE VARCHAR2(128),
  CONSTRAINT PK_NR_GOTM_ENTRIES_ID PRIMARY KEY (NR_GOTM_ID)
);

CREATE UNIQUE INDEX UX_NR_GOTM_ENTRIES_RND_IDX ON NR_GOTM_ENTRIES (ROUND_NUMBER, GAME_INDEX);

commit;
