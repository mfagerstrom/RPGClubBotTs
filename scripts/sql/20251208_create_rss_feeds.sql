CREATE TABLE RPG_CLUB_RSS_FEEDS (
  FEED_ID          NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
  FEED_NAME        VARCHAR2(200),
  FEED_URL         VARCHAR2(512) NOT NULL,
  CHANNEL_ID       VARCHAR2(30) NOT NULL,
  INCLUDE_KEYWORDS VARCHAR2(4000),
  EXCLUDE_KEYWORDS VARCHAR2(4000),
  CREATED_AT       TIMESTAMP WITH TIME ZONE DEFAULT SYSTIMESTAMP NOT NULL,
  UPDATED_AT       TIMESTAMP WITH TIME ZONE DEFAULT SYSTIMESTAMP NOT NULL
);

CREATE UNIQUE INDEX UX_RPG_CLUB_RSS_FEEDS_URL ON RPG_CLUB_RSS_FEEDS (FEED_URL);

CREATE OR REPLACE TRIGGER TRG_RPG_CLUB_RSS_FEEDS_UPD
BEFORE UPDATE ON RPG_CLUB_RSS_FEEDS
FOR EACH ROW
BEGIN
  :NEW.UPDATED_AT := SYSTIMESTAMP;
END;
/

CREATE TABLE RPG_CLUB_RSS_FEED_ITEMS (
  FEED_ID        NUMBER NOT NULL,
  ITEM_ID_HASH   VARCHAR2(128) NOT NULL,
  ITEM_GUID      VARCHAR2(512),
  ITEM_LINK      VARCHAR2(512),
  PUBLISHED_AT   TIMESTAMP WITH TIME ZONE,
  FIRST_SEEN_AT  TIMESTAMP WITH TIME ZONE DEFAULT SYSTIMESTAMP NOT NULL,
  CONSTRAINT PK_RPG_CLUB_RSS_FEED_ITEMS PRIMARY KEY (FEED_ID, ITEM_ID_HASH)
);

ALTER TABLE RPG_CLUB_RSS_FEED_ITEMS
  ADD CONSTRAINT FK_RSS_FEED_ITEMS_FEED FOREIGN KEY (FEED_ID)
  REFERENCES RPG_CLUB_RSS_FEEDS (FEED_ID);

commit;
