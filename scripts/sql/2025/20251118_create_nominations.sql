-- Creates nomination tables for upcoming GOTM and NR-GOTM rounds.
-- Each user may hold one nomination per round; rows track the target round (current+1),
-- nominator user id, game title, and timestamp.

CREATE TABLE GOTM_NOMINATIONS (
  NOMINATION_ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
  ROUND_NUMBER NUMBER NOT NULL,
  USER_ID VARCHAR2(64) NOT NULL,
  GAME_TITLE VARCHAR2(256) NOT NULL,
  NOMINATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL
);

ALTER TABLE GOTM_NOMINATIONS
  ADD CONSTRAINT PK_GOTM_NOMINATIONS PRIMARY KEY (NOMINATION_ID);

CREATE UNIQUE INDEX UX_GOTM_NOMINATIONS_ROUND_USER
  ON GOTM_NOMINATIONS (ROUND_NUMBER, USER_ID);

CREATE INDEX IX_GOTM_NOMINATIONS_ROUND
  ON GOTM_NOMINATIONS (ROUND_NUMBER);

CREATE TABLE NR_GOTM_NOMINATIONS (
  NOMINATION_ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
  ROUND_NUMBER NUMBER NOT NULL,
  USER_ID VARCHAR2(64) NOT NULL,
  GAME_TITLE VARCHAR2(256) NOT NULL,
  NOMINATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL
);

ALTER TABLE NR_GOTM_NOMINATIONS
  ADD CONSTRAINT PK_NR_GOTM_NOMINATIONS PRIMARY KEY (NOMINATION_ID);

CREATE UNIQUE INDEX UX_NR_GOTM_NOMS_ROUND_USER
  ON NR_GOTM_NOMINATIONS (ROUND_NUMBER, USER_ID);

CREATE INDEX IX_NR_GOTM_NOMS_ROUND
  ON NR_GOTM_NOMINATIONS (ROUND_NUMBER);

COMMIT;
