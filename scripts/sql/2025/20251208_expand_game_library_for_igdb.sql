-- Add IGDB specific columns to GAMES
ALTER TABLE GAMES ADD IGDB_ID NUMBER;
ALTER TABLE GAMES ADD SLUG VARCHAR2(255);
ALTER TABLE GAMES ADD TOTAL_RATING NUMBER;
ALTER TABLE GAMES ADD IGDB_URL VARCHAR2(512);
ALTER TABLE GAMES ADD CONSTRAINT UQ_GAMES_IGDB_ID UNIQUE (IGDB_ID);

-- Add IGDB mapping columns to Definitions
ALTER TABLE PLATFORM_DEFINITIONS ADD IGDB_PLATFORM_ID NUMBER;
ALTER TABLE REGION_DEFINITIONS ADD IGDB_REGION_ID NUMBER;

-- Update existing Region Mappings (IGDB Region IDs)
-- 1: Europe, 2: North America, 3: Australia, 4: NZ, 5: Japan, 6: China, 7: Asia, 8: Worldwide
UPDATE REGION_DEFINITIONS SET IGDB_REGION_ID = 2 WHERE REGION_CODE = 'NA';
UPDATE REGION_DEFINITIONS SET IGDB_REGION_ID = 1 WHERE REGION_CODE = 'EU';
UPDATE REGION_DEFINITIONS SET IGDB_REGION_ID = 5 WHERE REGION_CODE = 'JP';
UPDATE REGION_DEFINITIONS SET IGDB_REGION_ID = 8 WHERE REGION_CODE = 'WW';

-- Update existing Platform Mappings (Common IGDB Platform IDs)
UPDATE PLATFORM_DEFINITIONS SET IGDB_PLATFORM_ID = 130 WHERE PLATFORM_CODE = 'SWITCH';
UPDATE PLATFORM_DEFINITIONS SET IGDB_PLATFORM_ID = 167 WHERE PLATFORM_CODE = 'PS5';
UPDATE PLATFORM_DEFINITIONS SET IGDB_PLATFORM_ID = 48 WHERE PLATFORM_CODE = 'PS4';
UPDATE PLATFORM_DEFINITIONS SET IGDB_PLATFORM_ID = 6 WHERE PLATFORM_CODE = 'PC';
UPDATE PLATFORM_DEFINITIONS SET IGDB_PLATFORM_ID = 169 WHERE PLATFORM_CODE = 'XBOX'; -- Xbox Series X|S

-- Genres Tables
CREATE TABLE GENRES (
    GENRE_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NAME VARCHAR2(100) NOT NULL,
    IGDB_GENRE_ID NUMBER UNIQUE
);

CREATE TABLE GAME_GENRES (
    GAME_ID NUMBER NOT NULL,
    GENRE_ID NUMBER NOT NULL,
    CONSTRAINT PK_GAME_GENRES PRIMARY KEY (GAME_ID, GENRE_ID),
    CONSTRAINT FK_GG_GAME FOREIGN KEY (GAME_ID) REFERENCES GAMES(GAME_ID) ON DELETE CASCADE,
    CONSTRAINT FK_GG_GENRE FOREIGN KEY (GENRE_ID) REFERENCES GENRES(GENRE_ID)
);
