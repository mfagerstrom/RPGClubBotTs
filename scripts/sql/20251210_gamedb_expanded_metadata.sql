-- Companies (Developers, Publishers)
CREATE TABLE GAMEDB_COMPANIES (
    COMPANY_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NAME VARCHAR2(255) NOT NULL,
    IGDB_COMPANY_ID NUMBER UNIQUE
);

CREATE TABLE GAMEDB_GAME_COMPANIES (
    GAME_ID NUMBER NOT NULL,
    COMPANY_ID NUMBER NOT NULL,
    ROLE VARCHAR2(20) CHECK (ROLE IN ('Developer', 'Publisher')),
    CONSTRAINT PK_GAME_COMPANIES PRIMARY KEY (GAME_ID, COMPANY_ID, ROLE),
    CONSTRAINT FK_GC_GAME FOREIGN KEY (GAME_ID) REFERENCES GAMEDB_GAMES(GAME_ID) ON DELETE CASCADE,
    CONSTRAINT FK_GC_COMPANY FOREIGN KEY (COMPANY_ID) REFERENCES GAMEDB_COMPANIES(COMPANY_ID)
);

-- Themes
CREATE TABLE GAMEDB_THEMES (
    THEME_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NAME VARCHAR2(100) NOT NULL,
    IGDB_THEME_ID NUMBER UNIQUE
);

CREATE TABLE GAMEDB_GAME_THEMES (
    GAME_ID NUMBER NOT NULL,
    THEME_ID NUMBER NOT NULL,
    CONSTRAINT PK_GAME_THEMES PRIMARY KEY (GAME_ID, THEME_ID),
    CONSTRAINT FK_GT_GAME FOREIGN KEY (GAME_ID) REFERENCES GAMEDB_GAMES(GAME_ID) ON DELETE CASCADE,
    CONSTRAINT FK_GT_THEME FOREIGN KEY (THEME_ID) REFERENCES GAMEDB_THEMES(THEME_ID)
);

-- Game Modes
CREATE TABLE GAMEDB_GAME_MODES_DEF (
    MODE_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NAME VARCHAR2(100) NOT NULL,
    IGDB_GAME_MODE_ID NUMBER UNIQUE
);

CREATE TABLE GAMEDB_GAME_MODES (
    GAME_ID NUMBER NOT NULL,
    MODE_ID NUMBER NOT NULL,
    CONSTRAINT PK_GAME_MODES PRIMARY KEY (GAME_ID, MODE_ID),
    CONSTRAINT FK_GM_GAME FOREIGN KEY (GAME_ID) REFERENCES GAMEDB_GAMES(GAME_ID) ON DELETE CASCADE,
    CONSTRAINT FK_GM_MODE FOREIGN KEY (MODE_ID) REFERENCES GAMEDB_GAME_MODES_DEF(MODE_ID)
);

-- Player Perspectives
CREATE TABLE GAMEDB_PERSPECTIVES (
    PERSPECTIVE_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NAME VARCHAR2(100) NOT NULL,
    IGDB_PERSPECTIVE_ID NUMBER UNIQUE
);

CREATE TABLE GAMEDB_GAME_PERSPECTIVES (
    GAME_ID NUMBER NOT NULL,
    PERSPECTIVE_ID NUMBER NOT NULL,
    CONSTRAINT PK_GAME_PERSPECTIVES PRIMARY KEY (GAME_ID, PERSPECTIVE_ID),
    CONSTRAINT FK_GP_GAME FOREIGN KEY (GAME_ID) REFERENCES GAMEDB_GAMES(GAME_ID) ON DELETE CASCADE,
    CONSTRAINT FK_GP_PERSPECTIVE FOREIGN KEY (PERSPECTIVE_ID) REFERENCES GAMEDB_PERSPECTIVES(PERSPECTIVE_ID)
);

-- Game Engines
CREATE TABLE GAMEDB_ENGINES (
    ENGINE_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NAME VARCHAR2(255) NOT NULL,
    IGDB_ENGINE_ID NUMBER UNIQUE
);

CREATE TABLE GAMEDB_GAME_ENGINES (
    GAME_ID NUMBER NOT NULL,
    ENGINE_ID NUMBER NOT NULL,
    CONSTRAINT PK_GAME_ENGINES PRIMARY KEY (GAME_ID, ENGINE_ID),
    CONSTRAINT FK_GE_GAME FOREIGN KEY (GAME_ID) REFERENCES GAMEDB_GAMES(GAME_ID) ON DELETE CASCADE,
    CONSTRAINT FK_GE_ENGINE FOREIGN KEY (ENGINE_ID) REFERENCES GAMEDB_ENGINES(ENGINE_ID)
);

-- Franchises
CREATE TABLE GAMEDB_FRANCHISES (
    FRANCHISE_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NAME VARCHAR2(255) NOT NULL,
    IGDB_FRANCHISE_ID NUMBER UNIQUE
);

CREATE TABLE GAMEDB_GAME_FRANCHISES (
    GAME_ID NUMBER NOT NULL,
    FRANCHISE_ID NUMBER NOT NULL,
    CONSTRAINT PK_GAME_FRANCHISES PRIMARY KEY (GAME_ID, FRANCHISE_ID),
    CONSTRAINT FK_GF_GAME FOREIGN KEY (GAME_ID) REFERENCES GAMEDB_GAMES(GAME_ID) ON DELETE CASCADE,
    CONSTRAINT FK_GF_FRANCHISE FOREIGN KEY (FRANCHISE_ID) REFERENCES GAMEDB_FRANCHISES(FRANCHISE_ID)
);

-- Collections (Series)
CREATE TABLE GAMEDB_COLLECTIONS (
    COLLECTION_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NAME VARCHAR2(255) NOT NULL,
    IGDB_COLLECTION_ID NUMBER UNIQUE
);

-- Add Series/Collection link to GAMES (One-to-Many usually, Game belongs to one Collection)
ALTER TABLE GAMEDB_GAMES ADD COLLECTION_ID NUMBER;
ALTER TABLE GAMEDB_GAMES ADD CONSTRAINT FK_GAMES_COLLECTION FOREIGN KEY (COLLECTION_ID) REFERENCES GAMEDB_COLLECTIONS(COLLECTION_ID);

-- Parent Game (Spin-off / DLC relationship) - Storing loose link for now
ALTER TABLE GAMEDB_GAMES ADD PARENT_IGDB_ID NUMBER;
ALTER TABLE GAMEDB_GAMES ADD PARENT_GAME_NAME VARCHAR2(255);
