CREATE TABLE RPG_CLUB_PUBLIC_REMINDERS (
  REMINDER_ID     NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
  CHANNEL_ID      VARCHAR2(30) NOT NULL,
  MESSAGE         VARCHAR2(2000) NOT NULL,
  DUE_AT          TIMESTAMP WITH TIME ZONE NOT NULL,
  RECUR_EVERY     NUMBER,
  RECUR_UNIT      VARCHAR2(10),
  ENABLED         NUMBER(1,0) DEFAULT 1 NOT NULL,
  CREATED_BY      VARCHAR2(30),
  CREATED_AT      TIMESTAMP WITH TIME ZONE DEFAULT SYSTIMESTAMP NOT NULL,
  UPDATED_AT      TIMESTAMP WITH TIME ZONE DEFAULT SYSTIMESTAMP NOT NULL
);

CREATE INDEX IX_RPG_CLUB_PUBLIC_REMINDERS_DUE ON RPG_CLUB_PUBLIC_REMINDERS (DUE_AT, ENABLED);

CREATE OR REPLACE TRIGGER TRG_RPG_CLUB_PUBLIC_REMINDERS_UPD
BEFORE UPDATE ON RPG_CLUB_PUBLIC_REMINDERS
FOR EACH ROW
BEGIN
  :NEW.UPDATED_AT := SYSTIMESTAMP;
END;
/

commit;
